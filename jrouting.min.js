var JRFU={};var jR={LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100,version:'v3.0.1',cache:{},routes:[],history:[],errors:[],events:{},eventsOnce:{},global:{},query:{},params:[],middlewares:{},repository:{},url:'',model:null,isFirst:true,isReady:false,isRefresh:false,isModernBrowser:history.pushState?true:false,hashtags:false,count:0};if(!window.jR)window.jR=jR;if(!window.jRouting)window.jRouting=jR;if(!window.JRFU)window.JRFU=JRFU;jR.remove=function(r){var e=this;var t=[];for(var n=0,i=e.routes.length;n<i;n++)e.routes[n].id!==r&&t.push(e.routes[n]);e.routes=t;return e};jR.on=function(r,e){var t=this;var n=t.events[r];if(n)n.push(e);else t.events[r]=[e];return t};jR.once=function(r,e){var t=this;var n=t.eventsOnce[r];if(n)n.push(e);else t.eventsOnce[r]=[e];return t};jR.emit=function(r){var e=this;var t=e.events[r]||[];var n=e.eventsOnce[r]||[];var i=t.length;var a=n.length;if(!i&&!a)return e;var o=[];var s=arguments.length;for(var u=1;u<s;u++)o.push(arguments[u]);if(i>0){for(var u=0;u<i;u++)t[u].apply(e,o)}if(a){for(var u=0;u<i;u++)n[u].apply(e,o);delete e.eventsOnce[r]}};jR.route=function(r,e,t,n){var i;if(e instanceof Array){var i=t;t=e;e=i}if(typeof t==='function'){i=n;n=t;t=i}var a=r.count('/')+(r.indexOf('*')===-1?0:10);var o=jR._route(r.trim());var s=[];if(typeof t==='string')t=t.split(',');var u=[];var l=[];var c={};t instanceof Array&&t.forEach(function(r){if(typeof r==='object')c=r;else if(r.substring(0,1)==='@')l.push(r.substring(1));else u.push(r)});if(r.indexOf('{')!==-1){a-=100;for(var f=0;f<o.length;f++)o[f].substring(0,1)==='{'&&s.push(f);a-=s.length}jR.remove(r);jR.routes.push({id:r,url:o,fn:e,priority:a,params:s,middleware:u.length?u:null,init:n,count:0,pending:false,options:c,roles:l});jR.routes.sort(function(r,e){return r.priority>e.priority?-1:r.priority<e.priority?1:0});return jR};jR.middleware=function(r,e){var t=this;t.middlewares[r]=e;return t};jR.refresh=function(){var r=this;return r.location(r.url,true)};jR.reload=function(){return jR.refresh()};jR.async=function(){if(!window.jRoute||!window.jRoute.length)return;while(true){var r=window.jRoute.shift();if(!r)break;r()}jR.is404&&jR.location(jR.url)};jR._route=function(r){if(r.charCodeAt(0)===47)r=r.substring(1);if(r.charCodeAt(r.length-1)===47)r=r.substring(0,r.length-1);var e=r.split('/');if(e.length===1&&!e[0])e[0]='/';return e};jR._route_param=function(r,e){var t=[];if(!e||!r)return t;var n=e.params.length;if(n){for(var i=0;i<n;i++){var a=r[e.params[i]];t.push(a==='/'?'':a)}}return t};jR._route_compare=function(r,e){var t=r.length;var n=t===1&&r[0]==='/';if(e.length!==t)return false;for(var i=0;i<t;i++){var a=e[i];if(!a)return false;if(!n&&a.charCodeAt(0)===123)continue;if(a==='*')return true;if(r[i]!==a)return false}return true};jR.location=function(r,e){if(!jR.isReady)return;var t=r.indexOf('?');if(t!==-1)r=r.substring(0,t);r=JRFU.prepareUrl(r);r=JRFU.path(r);var n=this;var i=n._route(r);var a=[];var l=true;var o=[];o.push.apply(o,i);for(var s=0,u=i.length;s<u;s++)i[s]=i[s].toLowerCase();n.isRefresh=e||false;n.count++;if(!e&&n.url.length&&n.history[n.history.length-1]!==n.url){n.history.push(n.url);n.history.length>n.LIMIT_HISTORY&&n.history.shift()}var u=n.routes.length;for(var s=0;s<u;s++){var f=n.routes[s];if(!n._route_compare(i,f.url))continue;if(f.url.indexOf('*')===-1)l=false;if(f.once&&f.count>0)continue;f.count++;a.push(f);break}var c=false;var h=[];if(n.url.length)n.cache[n.url]=n.repository;n.url=r;n.repository=n.cache[r];if(!n.repository)n.repository={};n._params();n.params=n._route_param(o,f);n.is404=false;n.emit('location',r);u=a.length;for(var s=0;s<u;s++){var f=a[s];if(f.pending)continue;if(!f.middleware||!f.middleware.length){if(!f.init){f.fn.apply(n,n.params);continue}f.pending=true;(function(r){r.init(function(){r.fn.apply(n,n.params);r.pending=false})})(f);f.init=null;continue}(function(e){var r=e.middleware.length;var n=[];for(var t=0;t<r;t++){var i=jR.middlewares[e.middleware[t]];i&&function(e,t){n.push(function(r){t.call(jR,r,e.options,e.roles,e)})}(e,i)}if(!e.init){e.pending=true;n.middleware(function(r){!r&&e.fn.apply(jR,jR.params);e.pending=false},e);return}e.pending=true;e.init(function(){n.middleware(function(r){!r&&e.fn.apply(jR,jR.params);e.pending=false},e)});e.init=null})(f)}c&&n.status(500,h);n.is404=true;l&&n.status(404,new Error('Route not found.'))};jR.prev=function(){return this.history[this.history.length-1]};jR.back=function(){var r=this;var e=r.history.pop()||'/';r.url='';r.redirect(e,true);return r};jR.status=function(r,e){var t=this;t.emit('status',r||404,e);return t};jR.redirect=function(r,e){var t=this;if(r.charCodeAt(0)===35){location.hash=r;t.model=e||null;t.location(r,false);return t}if(!t.isModernBrowser){location.href=r;return false}history.pushState(null,null,r);t.model=e||null;t.location(r,false);return t};jR._params=function(){var r=this;var e={};var t=location.href.slice(location.href.indexOf('?')+1).split('&');for(var n=0;n<t.length;n++){var i=t[n].replace(/\+/g,'%20').split('=');if(i.length!==2)continue;var a=decodeURIComponent(i[0]);var o=decodeURIComponent(i[1]);var s=e[a]instanceof Array;if(e[a]&&!s)e[a]=[e[a]];if(s)e[a].push(o);else e[a]=o}r.query=e;return r};jR.path=JRFU.path=function(r,e){if(r.substring(0,1)==='#')return r;if(!e)e='/';var t=r.indexOf('?');var n='';if(t!==-1){n=r.substring(t);r=r.substring(0,t)}var i=r.length;var a=r.substring(i-1,i);if(a!==e)r+=e;return r+n};JRFU.prepareUrl=function(r){if(r.substring(0,1)==='#')return r;var e=r.indexOf('#');return e!==-1?r.substring(0,e):r};if(!Array.prototype.middleware){Array.prototype.middleware=function(e,t){var n=this;var r=n.shift();if(r===undefined){e&&e();return n}r(function(r){if(r instanceof Error||r===false)e&&e(r===false?true:r);else setTimeout(function(){n.middleware(e,t)},1)},t.options,t.roles);return n}}if(!String.prototype.count){String.prototype.count=function(r){var e=0;var t=0;do{e=this.indexOf(r,e+r.length);if(e>0)t++}while(e>0);return t}}jR.on('error',function(r,e,t){var n=this;n.errors.push({error:r,url:e,name:t,date:new Date});n.errors.length>n.LIMIT_HISTORY_ERROR&&n.errors.shift()});jR.clientside=function(r){$(document).on('click',r,function(r){r.preventDefault();var e=$(this);jR.redirect(e.attr('href')||e.attr('data-jrouting')||e.attr('data-jr'))});return jR};function jRinit(){jR.async();$.fn.jRouting=function(r){if(jR.hashtags||!jR.isModernBrowser)return this;var e=+$.fn.jquery.replace(/\./g,'');if(e>=300&&r===true)throw Error('$(selector).jRouting() doesn\'t work in jQuery +3. Instead of this use jR.clientside(selector).');var t=function(r){r.preventDefault();jR.redirect($(this).attr('href'))};if(r)$(document).on('click',this.selector,t);else this.filter('a').bind('click',t);return this};$(document).ready(function(){jR.async();if(jR.hashtags)jR.url=location.hash||JRFU.path(JRFU.prepareUrl(location.pathname));else jR.url=JRFU.path(JRFU.prepareUrl(location.pathname));if(jR.events.ready){jR.emit('ready',jR.url);jR.emit('load',jR.url)}else{setTimeout(function(){jR.isReady=true;jR.location(jR.url);jR.emit('ready',jR.url);jR.emit('load',jR.url)},5)}$(window).on('hashchange',function(){if(!jR.isReady||!jR.hashtags)return;jR.location(JRFU.path(location.hash))});$(window).on('popstate',function(){if(!jR.isReady||jR.hashtags)return;var r=JRFU.path(location.pathname);jR.url!==r&&jR.location(r)})})}if(window.jQuery){jRinit()}else{jR.init=setInterval(function(){if(window.jQuery){clearInterval(jR.init);jRinit()}},100)}setTimeout(jR.async,500);setTimeout(jR.async,1e3);setTimeout(jR.async,2e3);setTimeout(jR.async,3e3);setTimeout(jR.async,5e3);window.ROUTE=function(r,e,t,n){return jR.route(r,e,t,n)};