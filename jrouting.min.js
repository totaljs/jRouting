var JRFU={},jR={LIMIT_HISTORY:100,LIMIT_HISTORY_ERROR:100,version:'v3.0.1',cache:{},routes:[],history:[],errors:[],events:{},eventsOnce:{},global:{},query:{},params:[],middlewares:{},repository:{},url:'',model:null,isFirst:!0,isReady:!1,isRefresh:!1,isModernBrowser:!!history.pushState,hashtags:!1,count:0};function jRinit(){jR.async(),$.fn.jRouting=function(t){if(jR.hashtags||!jR.isModernBrowser)return this;if(300<=+$.fn.jquery.replace(/\./g,'')&&!0===t)throw Error('$(selector).jRouting() doesn\'t work in jQuery +3. Instead of this use jR.clientside(selector).');var r=function(t){t.preventDefault(),jR.redirect($(this).attr('href'))};return t?$(document).on('click',this.selector,r):this.filter('a').bind('click',r),this},$(document).ready(function(){jR.async(),jR.hashtags?jR.url=location.hash||JRFU.path(JRFU.prepareUrl(location.pathname)):jR.url=JRFU.path(JRFU.prepareUrl(location.pathname)),jR.events.ready?(jR.emit('ready',jR.url),jR.emit('load',jR.url)):setTimeout(function(){jR.isReady=!0,jR.location(jR.url),jR.emit('ready',jR.url),jR.emit('load',jR.url)},5),$(window).on('hashchange',function(){jR.isReady&&jR.hashtags&&jR.location(JRFU.path(location.hash))}),$(window).on('popstate',function(){if(jR.isReady&&!jR.hashtags){var t=JRFU.path(location.pathname);jR.url!==t&&jR.location(t)}})})}window.jR||(window.jR=jR),window.jRouting||(window.jRouting=jR),window.JRFU||(window.JRFU=JRFU),jR.remove=function(t){for(var r=this,n=[],e=0,i=r.routes.length;e<i;e++)r.routes[e].id!==t&&n.push(r.routes[e]);return r.routes=n,r},jR.on=function(t,r){var n=this,e=n.events[t];return e?e.push(r):n.events[t]=[r],n},jR.once=function(t,r){var n=this,e=n.eventsOnce[t];return e?e.push(r):n.eventsOnce[t]=[r],n},jR.emit=function(t){var r=this,n=r.events[t]||[],e=r.eventsOnce[t]||[],i=n.length,o=e.length;if(!i&&!o)return r;for(var s=[],a=arguments.length,u=1;u<a;u++)s.push(arguments[u]);if(0<i)for(u=0;u<i;u++)n[u].apply(r,s);if(o){for(u=0;u<i;u++)e[u].apply(r,s);delete r.eventsOnce[t]}},jR.route=function(t,r,n,e){if(r instanceof Array){var i=n;n=r,r=i}'function'==typeof n&&(i=e,e=n,n=i);var o=t.count('/')+(-1===t.indexOf('*')?0:10),s=jR._route(t.trim()),a=[];'string'==typeof n&&(n=n.split(','));var u=[],l=[],h={};if(n instanceof Array&&n.forEach(function(t){'object'==typeof t?h=t:'@'===t.substring(0,1)?l.push(t.substring(1)):u.push(t)}),-1!==t.indexOf('{')){o-=100;for(var c=0;c<s.length;c++)'{'===s[c].substring(0,1)&&a.push(c);o-=a.length}return jR.remove(t),jR.routes.push({id:t,url:s,fn:r,priority:o,params:a,middleware:u.length?u:null,init:e,count:0,pending:!1,options:h,roles:l}),jR.routes.sort(function(t,r){return t.priority>r.priority?-1:t.priority<r.priority?1:0}),jR},jR.middleware=function(t,r){return this.middlewares[t]=r,this},jR.refresh=function(){return this.location(this.url,!0)},jR.reload=function(){return jR.refresh()},jR.async=function(){if(window.jRoute&&window.jRoute.length){for(;;){var t=window.jRoute.shift();if(!t)break;t()}jR.is404&&jR.location(jR.url)}},jR._route=function(t){47===t.charCodeAt(0)&&(t=t.substring(1)),47===t.charCodeAt(t.length-1)&&(t=t.substring(0,t.length-1));var r=t.split('/');return 1!==r.length||r[0]||(r[0]='/'),r},jR._route_param=function(t,r){var n=[];if(!r||!t)return n;var e=r.params.length;if(e)for(var i=0;i<e;i++){var o=t[r.params[i]];n.push('/'===o?'':o)}return n},jR._route_compare=function(t,r){var n=t.length,e=1===n&&'/'===t[0];if(r.length!==n)return!1;for(var i=0;i<n;i++){var o=r[i];if(!o)return!1;if(e||123!==o.charCodeAt(0)){if('*'===o)return!0;if(t[i]!==o)return!1}}return!0},jR.location=function(t,r){if(jR.isReady){var n=t.indexOf('?');-1!==n&&(t=t.substring(0,n)),t=JRFU.prepareUrl(t),t=JRFU.path(t);var e=this,i=e._route(t),o=[],s=!0,a=[];a.push.apply(a,i);for(var u=0,l=i.length;u<l;u++)i[u]=i[u].toLowerCase();e.isRefresh=r||!1,e.count++,!r&&e.url.length&&e.history[e.history.length-1]!==e.url&&(e.history.push(e.url),e.history.length>e.LIMIT_HISTORY&&e.history.shift());for(l=e.routes.length,u=0;u<l;u++){var h=e.routes[u];if(e._route_compare(i,h.url)&&(-1===h.url.indexOf('*')&&(s=!1),!(h.once&&0<h.count))){h.count++,o.push(h);break}}e.url.length&&(e.cache[e.url]=e.repository),e.url=t,e.repository=e.cache[t],e.repository||(e.repository={}),e._params(),e.params=e._route_param(a,h),e.is404=!1,e.emit('location',t),l=o.length;for(u=0;u<l;u++){if(!(h=o[u]).pending)if(h.middleware&&h.middleware.length)!function(r){for(var t=r.middleware.length,e=[],n=0;n<t;n++){var i=jR.middlewares[r.middleware[n]];i&&function(r,n){e.push(function(t){n.call(jR,t,r.options,r.roles,r)})}(r,i)}if(!r.init)return r.pending=!0,e.middleware(function(t){!t&&r.fn.apply(jR,jR.params),r.pending=!1},r);r.pending=!0,r.init(function(){e.middleware(function(t){!t&&r.fn.apply(jR,jR.params),r.pending=!1},r)}),r.init=null}(h);else{if(!h.init){h.fn.apply(e,e.params);continue}h.pending=!0,function(t){t.init(function(){t.fn.apply(e,e.params),t.pending=!1})}(h),h.init=null}}e.is404=!0,s&&e.status(404,new Error('Route not found.'))}},jR.prev=function(){return this.history[this.history.length-1]},jR.back=function(){var t=this.history.pop()||'/';return this.url='',this.redirect(t,!0),this},jR.status=function(t,r){return this.emit('status',t||404,r),this},jR.redirect=function(t,r){var n=this;return 35===t.charCodeAt(0)?(location.hash=t,n.model=r||null,n.location(t,!1),n):n.isModernBrowser?(history.pushState(null,null,t),n.model=r||null,n.location(t,!1),n):(location.href=t,!1)},jR._params=function(){for(var t={},r=location.href.slice(location.href.indexOf('?')+1).split('&'),n=0;n<r.length;n++){var e=r[n].replace(/\+/g,'%20').split('=');if(2===e.length){var i=decodeURIComponent(e[0]),o=decodeURIComponent(e[1]),s=t[i]instanceof Array;t[i]&&!s&&(t[i]=[t[i]]),s?t[i].push(o):t[i]=o}}return this.query=t,this},jR.path=JRFU.path=function(t,r){if('#'===t.substring(0,1))return t;r||(r='/');var n=t.indexOf('?'),e='';-1!==n&&(e=t.substring(n),t=t.substring(0,n));var i=t.length;return t.substring(i-1,i)!==r&&(t+=r),t+e},JRFU.prepareUrl=function(t){if('#'===t.substring(0,1))return t;var r=t.indexOf('#');return-1!==r?t.substring(0,r):t},Array.prototype.middleware||(Array.prototype.middleware=function(r,n){var e=this,t=e.shift();return void 0===t?r&&r():t(function(t){t instanceof Error||!1===t?r&&r(!1===t||t):setTimeout(function(){e.middleware(r,n)},1)},n.options,n.roles),e}),String.prototype.count||(String.prototype.count=function(t){for(var r=0,n=0;0<(r=this.indexOf(t,r+t.length))&&n++,0<r;);return n}),jR.on('error',function(t,r,n){this.errors.push({error:t,url:r,name:n,date:new Date}),this.errors.length>this.LIMIT_HISTORY_ERROR&&this.errors.shift()}),jR.clientside=function(t){return $(document).on('click',t,function(t){t.preventDefault();var r=$(this);jR.redirect(r.attr('href')||r.attr('data-jrouting')||r.attr('data-jr'))}),jR},window.jQuery?jRinit():jR.init=setInterval(function(){window.jQuery&&(clearInterval(jR.init),jRinit())},100),setTimeout(jR.async,500),setTimeout(jR.async,1e3),setTimeout(jR.async,2e3),setTimeout(jR.async,3e3),setTimeout(jR.async,5e3),window.ROUTE=function(t,r,n,e){return jR.route(t,r,n,e)};